
## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ api/                    # API Layer (HTTP —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dependencies.py     # FastAPI –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ v1/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ router.py       # –ì–ª–∞–≤–Ω—ã–π v1 —Ä–æ—É—Ç–µ—Ä
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ endpoints/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ chat.py     # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —á–∞—Ç–∞
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ health.py   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ legacy/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ router.py       # –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ /request —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/               # –°–ª–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat_service.py     # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —á–∞—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telegram_service.py # Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ai/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ base.py         # AIProvider ABC
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ groq_provider.py # –û—Å–Ω–æ–≤–Ω–æ–π AI
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ gemini_provider.py # –†–µ–∑–µ—Ä–≤–Ω—ã–π AI
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ repositories/           # –°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat_repository.py  # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–∞—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ log_repository.py   # CRUD –ª–æ–≥–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ models/                 # SQLAlchemy ORM –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py             # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat.py             # ChatRequest –º–æ–¥–µ–ª—å
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ log.py              # RequestLog –º–æ–¥–µ–ª—å
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ schemas/                # Pydantic DTO
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ chat.py             # –°—Ö–µ–º—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ core/                   # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py           # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py         # DB engine & sessions
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ exceptions.py       # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ middleware/
‚îÇ       ‚îî‚îÄ‚îÄ logging.py          # Middleware –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ alembic/                    # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ main.py                     # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ pyproject.toml              # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ Dockerfile                  # Docker —Å–±–æ—Ä–∫–∞
```

## API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### V1 –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã (–¢–µ–∫—É—â–∏–µ)

**`GET /api/v1/chat/history`**
- –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ IP
- –û—Ç–≤–µ—Ç: `{items: [{id, prompt, response, created_at, user_agent}, ...]}`

**`POST /api/v1/chat`**
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É
- –ó–∞–ø—Ä–æ—Å: `{prompt: "–≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"}`
- –û—Ç–≤–µ—Ç: `{answer: "–æ—Ç–≤–µ—Ç AI"}`

**`GET /api/v1/health`**
- –≠–Ω–¥–ø–æ–∏–Ω—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è
- –û—Ç–≤–µ—Ç: `{status: "ok"}`

### Legacy –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã (–£—Å—Ç–∞—Ä–µ–≤—à–∏–µ)

**`GET /request`** - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/api/v1/chat/history` –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ

**`POST /request`** - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/api/v1/chat` –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ


## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   ```bash
   cd backend
   pip install -e .
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ PostgreSQL:**
   ```bash
   # –ò—Å–ø–æ–ª—å–∑—É—è docker-compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
   docker-compose up -d postgres

   # –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PostgreSQL –ª–æ–∫–∞–ª—å–Ω–æ
   # –û–±–Ω–æ–≤–∏—Ç–µ DATABASE_URL –≤ .env —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ
   ```

3. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
   ```bash
   alembic upgrade head
   ```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:**
   ```bash
   python main.py
   ```

   –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ http://localhost:8000

   API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8000/docs

### Docker —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ

```bash
# –°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up -d --build

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f backend

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose down

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ backend
docker-compose up -d --build backend
```

## –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "–æ–ø–∏—Å–∞–Ω–∏–µ"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic downgrade -1

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π
alembic history
```

## –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏

1. **–°–æ–∑–¥–∞–π—Ç–µ –º–æ–¥–µ–ª—å** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ) –≤ `src/models/`
2. **–°–æ–∑–¥–∞–π—Ç–µ —Å—Ö–µ–º—É** –≤ `src/schemas/`
3. **–°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π** –≤ `src/repositories/`
4. **–°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å** –≤ `src/services/`
5. **–°–æ–∑–¥–∞–π—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç** –≤ `src/api/v1/endpoints/`
6. **–î–æ–±–∞–≤—å—Ç–µ –≤ —Ä–æ—É—Ç–µ—Ä** –≤ `src/api/v1/router.py`
7. **–°–æ–∑–¥–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é**: `alembic revision --autogenerate -m "add_feature"`

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
curl http://localhost:8000/api/v1/health

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
curl -X POST http://localhost:8000/api/v1/chat \
  -H "Content-Type: application/json" \
  -d '{"prompt": "–ü—Ä–∏–≤–µ—Ç, –∫—Ç–æ —Ç—ã?"}'

# –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞
curl http://localhost:8000/api/v1/chat/history
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram

–ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ (—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –æ–±–∞ `TELEGRAM_BOT_TOKEN` –∏ `TELEGRAM_CHAT_ID`), backend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫–∞–∂–¥–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å —á–∞—Ç–æ–º:

**–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç:**
- IP –∞–¥—Ä–µ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–æ–æ–±—â–µ–Ω–∏–µ/–∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π AI
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±—Ä–∞—É–∑–µ—Ä–µ (–∏–∑–≤–ª–µ—á—ë–Ω–Ω—É—é –∏–∑ User-Agent)

**–§–æ—Ä–º–∞—Ç:**
```
ü§ñ –ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É

üë§ IP: 192.168.1.100
üí¨ –ó–∞–ø—Ä–æ—Å:
–ü—Ä–∏–≤–µ—Ç, –∫—Ç–æ —Ç—ã?

üåê –ë—Ä–∞—É–∑–µ—Ä: Chrome
```

**–ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É:** –û—à–∏–±–∫–∏ Telegram –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —á–∞—Ç–∞.

## –ü—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –°–ª–æ–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

1. **API Layer** (`src/api/`)
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (Pydantic —Å—Ö–µ–º—ã)
   - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
   - –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

2. **Service Layer** (`src/services/`)
   - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
   - –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –º–µ–∂–¥—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ API (AI, Telegram)
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

3. **Repository Layer** (`src/repositories/`)
   - –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (CRUD)
   - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

4. **Model Layer** (`src/models/`)
   - SQLAlchemy ORM –º–æ–¥–µ–ª–∏
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```python
# src/api/dependencies.py
def get_chat_service(db: Session = Depends(get_db)) -> ChatService:
    chat_repo = ChatRepository(db)
    return ChatService(chat_repo)

# src/api/v1/endpoints/chat.py
@router.post("")
def send_chat_prompt(
    request: Request,
    prompt: str = Body(..., embed=True),
    chat_service: ChatService = Depends(get_chat_service)
):
    # chat_service –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–Ω–µ–¥—Ä—è–µ—Ç—Å—è
    ...
```

### –ü–∞—Ç—Ç–µ—Ä–Ω AI Provider

```python
# src/services/ai/base.py
class AIProvider(ABC):
    @abstractmethod
    def get_answer(self, prompt: str) -> str:
        pass

# –û—Å–Ω–æ–≤–Ω–æ–π: Groq, –†–µ–∑–µ—Ä–≤–Ω—ã–π: Gemini
try:
    answer = self.primary_ai.get_answer(prompt)
except AIProviderError:
    answer = self.fallback_ai.get_answer(prompt)
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è CORS

–†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (–Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ `src/core/config.py`):
- http://localhost:3000
- http://127.0.0.1:3000
- https://apolyakov.tech
- https://www.apolyakov.tech
- https://api.apolyakov.tech
- https://www.api.apolyakov.tech

