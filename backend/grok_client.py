from groq import Groq, RateLimitError, APIError
from config import config_obj

client = Groq(api_key=config_obj.grok_api_key)

MODELS_PRIORITY = [
    "llama-3.3-70b-versatile",
    "llama-3.1-8b-instant",
]


def load_andrey_context():
    return """
    –ò–º—è: –ê–Ω–¥—Ä–µ–π
    –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: 10.06.1998 (27 –ª–µ—Ç)

    –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ: 
    - –°–ó–ì–ú–£ (–°–µ–≤–µ—Ä–æ-–ó–∞–ø–∞–¥–Ω—ã–π –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç).
    - –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å: –í—Ä–∞—á-–ª–µ—á–µ–±–Ω–∏–∫.
    -
    –†–∞–±–æ—Ç–∞: 
    - –î–æ–ª–∂–Ω–æ—Å—Ç—å: AQA Engineer (–∞–≤—Ç–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫).
    - –¢–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç: LEADS TECH.

    –õ–∏—á–Ω–æ–µ:
    - –î–µ–≤—É—à–∫–∞: –õ–µ—Ä–∞ (–≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è —É–∂–µ 8 –ª–µ—Ç).
    - –ê–≤—Ç–æ–º–æ–±–∏–ª—å: Audi A3.
    - –î—Ä—É–∑—å—è: –î—Ä—É–≥ –ú–∏—à–∞ (—Ç–æ–∂–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫).–î–∞–Ω–∏–ª - –≤—Ä–∞—á —Ç—Ä–∞–≤–º–æ—Ç–æ–ª–æ–≥-–ª–æ—Ö–æ–ø–µ–¥, 
    - –•–æ–±–±–∏: –ê–Ω–∏–º–µ, –î–æ—Ç–∞ 2.
    - –õ—é–±–∏–º–∞—è –µ–¥–∞: —à–∞—É—Ä–º–∞.
    - –õ—é–±–∏–º—ã–π –Ω–∞–ø–∏—Ç–æ–∫: —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫, –±–µ–∑ —Å–∞—Ö–∞—Ä–∞, black monster
    - –†–∞–∑–º–µ—Ä –ø–∏—Å—é–Ω–∞: 50—Å–º
    - –†–æ–¥–∏–ª—Å—è –≤ –ë–µ–ª–æ—Ä—É—Å—Å–∏–∏ –≥–æ—Ä–æ–¥ –ú–æ–≥–∏–ª–µ–≤
    - –ü—Ä–æ–∂–∏–ª –Ω–∞ —Å–µ–≤–µ—Ä–µ 18 –ª–µ—Ç
    - –ö–æ—Ç –±—Ä–∏—Ç–∞–Ω—Å–∫–∞—è —Å–µ—Ä–µ–±—Ä–∏—Å—Ç–∞—è —à–∏–Ω—à–∏–ª–∞
    - –ü–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å–æ –º–Ω–æ–π –Ω–µ–ª—å–∑—è,–∑–∞–Ω—è—Ç –õ–µ—Ä–æ–π –ù–∏–∫–æ–Ω–æ–≤–æ–π
    - 
    –ö–æ–Ω—Ç–∞–∫—Ç: @dreusus –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–µ.
    """


def get_answer_for_grok(user_prompt: str):
    context_data = load_andrey_context()

    system_instruction = f"""
    –¢—ã ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ê–Ω–¥—Ä–µ—è.
    [[–î–ê–ù–ù–´–ï]]
    {context_data}
    [[–ö–û–ù–ï–¶]]
    –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –≤—ã—à–µ.
    """

    messages = [
        {"role": "system", "content": system_instruction},
        {"role": "user", "content": user_prompt}
    ]

    for model_name in MODELS_PRIORITY:
        try:
            print(f"ü§ñ –ü—Ä–æ–±—É—é –º–æ–¥–µ–ª—å: {model_name}...")

            response = client.chat.completions.create(
                messages=messages,
                model=model_name,
                temperature=0.3,
            )

            return response.choices[0].message.content

        except RateLimitError as e:
            print(f"‚ö†Ô∏è –õ–∏–º–∏—Ç –Ω–∞ {model_name} –∏—Å—á–µ—Ä–ø–∞–Ω! (–û—à–∏–±–∫–∞: {e})")
            print("üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∞—é—Å—å –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –º–æ–¥–µ–ª—å...")
            continue  # –ò–¥–µ–º –∫ —Å–ª–µ–¥—É—é—â–µ–π –º–æ–¥–µ–ª–∏ –≤ —Å–ø–∏—Å–∫–µ

        except APIError as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ API Groq: {e}")
            return "–£–ø—Å, –º–æ–∑–≥–∏ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ."

    return "‚õîÔ∏è –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤—Å–µ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ —Å–µ–π—á–∞—Å –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω—ã. –ê–Ω–¥—Ä–µ–π —Å–ª–∏—à–∫–æ–º –ø–æ–ø—É–ª—è—Ä–µ–Ω!"
